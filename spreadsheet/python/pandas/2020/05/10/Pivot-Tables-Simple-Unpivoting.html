<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting | Samuel Oranyeli</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting" />
<meta name="author" content="Samuel Oranyeli" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Extract data from pivot tables in a spreadsheet" />
<meta property="og:description" content="Extract data from pivot tables in a spreadsheet" />
<link rel="canonical" href="https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html" />
<meta property="og:url" content="https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html" />
<meta property="og:site_name" content="Samuel Oranyeli" />
<meta property="og:image" content="https://samukweku.github.io/data-wrangling-blog/images/some_folder/your_image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-10T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2020-05-10T00:00:00-05:00","author":{"@type":"Person","name":"Samuel Oranyeli"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html"},"image":"https://samukweku.github.io/data-wrangling-blog/images/some_folder/your_image.png","description":"Extract data from pivot tables in a spreadsheet","@type":"BlogPosting","url":"https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html","headline":"SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting","dateModified":"2020-05-10T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/data-wrangling-blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://samukweku.github.io/data-wrangling-blog/feed.xml" title="Samuel Oranyeli" /><link rel="shortcut icon" type="image/x-icon" href="/data-wrangling-blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting | Samuel Oranyeli</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting" />
<meta name="author" content="Samuel Oranyeli" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Extract data from pivot tables in a spreadsheet" />
<meta property="og:description" content="Extract data from pivot tables in a spreadsheet" />
<link rel="canonical" href="https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html" />
<meta property="og:url" content="https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html" />
<meta property="og:site_name" content="Samuel Oranyeli" />
<meta property="og:image" content="https://samukweku.github.io/data-wrangling-blog/images/some_folder/your_image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-10T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2020-05-10T00:00:00-05:00","author":{"@type":"Person","name":"Samuel Oranyeli"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html"},"image":"https://samukweku.github.io/data-wrangling-blog/images/some_folder/your_image.png","description":"Extract data from pivot tables in a spreadsheet","@type":"BlogPosting","url":"https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html","headline":"SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting","dateModified":"2020-05-10T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://samukweku.github.io/data-wrangling-blog/feed.xml" title="Samuel Oranyeli" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
<script type="text/javascript">
require.config({
  paths: {
    jquery: 'https://code.jquery.com/jquery-3.5.0.min',
    plotly: 'https://cdn.plot.ly/plotly-latest.min'
  },

  shim: {
    plotly: {
      deps: ['jquery'],
      exports: 'plotly'
    }
  }
});
</script>

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/data-wrangling-blog/">Samuel Oranyeli</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/data-wrangling-blog/about/">About Me</a><a class="page-link" href="/data-wrangling-blog/search/">Search</a><a class="page-link" href="/data-wrangling-blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting</h1><p class="page-description">Extract data from pivot tables in a spreadsheet</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-05-10T00:00:00-05:00" itemprop="datePublished">
        May 10, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Samuel Oranyeli</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      13 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/data-wrangling-blog/categories/#Spreadsheet">Spreadsheet</a>
        &nbsp;
      
        <a class="category-tags-link" href="/data-wrangling-blog/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/data-wrangling-blog/categories/#Pandas">Pandas</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/samukweku/data-wrangling-blog/tree/master/_notebooks/2020-05-10-Pivot Tables - Simple Unpivoting.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/data-wrangling-blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Pivot-Tables---Simple-Unpivoting">Pivot Tables - Simple Unpivoting </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Case-1:-Multiple-Row-and-Column-headers">Case 1: Multiple Row and Column headers </a></li>
<li class="toc-entry toc-h3"><a href="#Case-2-:-Multiple-rows-or-columns-of-headers,-with-meaningful-formatting">Case 2 : Multiple rows or columns of headers, with meaningful formatting </a></li>
<li class="toc-entry toc-h3"><a href="#Case-3-:-Mixed-headers-and-notes-in-the-same-row/column,-distinguished-by-formatting">Case 3 : Mixed headers and notes in the same row/column, distinguished by formatting </a></li>
<li class="toc-entry toc-h3"><a href="#Case-4:-Mixed-levels-of-headers-in-the-same-row/column,-distinguished-by-formatting">Case 4: Mixed levels of headers in the same row/column, distinguished by formatting </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-05-10-Pivot Tables - Simple Unpivoting.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Pivot-Tables---Simple-Unpivoting">
<a class="anchor" href="#Pivot-Tables---Simple-Unpivoting" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Pivot Tables - Simple Unpivoting</strong><a class="anchor-link" href="#Pivot-Tables---Simple-Unpivoting"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>updated : April 14, 2022</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is part of a series of blog posts about extracting data from spreadsheets using Python.  It is based on the <a href="https://nacnudus.github.io/spreadsheet-munging-strategies/index.html">book</a> written by <a href="https://twitter.com/nacnudus?lang=en">Duncan Garmonsway</a>, which was written primarily for R users. LInks to the other posts are on the <a href="https://samukweku.github.io/data-wrangling-blog/">homepage</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Pivot tables offer a summarized version of the data, and are usually succinct and visually appealing. However, for analysis, it is not so good. How do we convert pivot tables to tidy data? This section covers that. We'll see various kinds of pivot tables, and work through each of them.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># pip install git+https://github.com/pyjanitor-devs/pyjanitor.git</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">janitor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">excel_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="s2">"Data_files/worked-examples.xlsx"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">'openpyxl'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Case-1:-Multiple-Row-and-Column-headers">
<a class="anchor" href="#Case-1:-Multiple-Row-and-Column-headers" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Case 1: Multiple Row and Column headers</strong><a class="anchor-link" href="#Case-1:-Multiple-Row-and-Column-headers"> </a>
</h3>
<p><img src="/data-wrangling-blog/images/copied_from_nb/Images/pivot-annotations.png" alt="pivot-annotations.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/data-wrangling-blog/images/copied_from_nb/Images/formattedrowsandcolumns.jpg" alt="pivot-annotations-headerrowandcolumn.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Observations</strong>:</p>
<ol>
<li>There are two header rows - gender and names.</li>
<li>There are also two header columns on the left - Fields(Humanities, Performance) and Subjects(Classics, History, ...)</li>
<li>For this case we wont be concerned with the colour formats. We'll look at that in a later section.</li>
</ol>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">excel_file</span>
     <span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">'pivot-annotations'</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
     <span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
     <span class="p">)</span>

<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">Female</th>
      <th colspan="2" halign="left">Male</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>Matilda</th>
      <th>Olivia</th>
      <th>Nicholas</th>
      <th>Paul</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Humanities</th>
      <th>Classics</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>NaN</th>
      <th>History</th>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Performance</th>
      <th>Music</th>
      <td>5</td>
      <td>6</td>
      <td>9</td>
      <td>2</td>
    </tr>
    <tr>
      <th>Drama</th>
      <td>7</td>
      <td>8</td>
      <td>12</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'field'</span><span class="p">,</span> <span class="s1">'subject'</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'gender'</span><span class="p">,</span> <span class="s1">'student'</span><span class="p">]</span>

<span class="p">(</span><span class="n">df</span>
<span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="s1">'gender'</span><span class="p">,</span> <span class="s1">'student'</span><span class="p">])</span>
<span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">'scores'</span><span class="p">)</span>
<span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>field</th>
      <th>subject</th>
      <th>gender</th>
      <th>student</th>
      <th>scores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Female</td>
      <td>Matilda</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Female</td>
      <td>Olivia</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Male</td>
      <td>Nicholas</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Male</td>
      <td>Paul</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Female</td>
      <td>Matilda</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Female</td>
      <td>Olivia</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Male</td>
      <td>Nicholas</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Male</td>
      <td>Paul</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Female</td>
      <td>Matilda</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Female</td>
      <td>Olivia</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Male</td>
      <td>Nicholas</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Male</td>
      <td>Paul</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Female</td>
      <td>Matilda</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Female</td>
      <td>Olivia</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Male</td>
      <td>Nicholas</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Male</td>
      <td>Paul</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Case-2-:-Multiple-rows-or-columns-of-headers,-with-meaningful-formatting">
<a class="anchor" href="#Case-2-:-Multiple-rows-or-columns-of-headers,-with-meaningful-formatting" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Case 2 : Multiple rows or columns of headers, with meaningful formatting</strong><a class="anchor-link" href="#Case-2-:-Multiple-rows-or-columns-of-headers,-with-meaningful-formatting"> </a>
</h3>
<p><img src="/data-wrangling-blog/images/copied_from_nb/Images/pivot-annotations.png" alt="pivot-annotations.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Same as above, except we have to capture the format details. To get the colour information, we'll make use of the <a href="https://pyjanitor-devs.github.io/pyjanitor/api/io/#janitor.io.xlsx_cells">xlsx_cells</a> function from <a href="https://pyjanitor-devs.github.io/pyjanitor/">pyjanitor</a> - under the hood, it uses <a href="https://openpyxl.readthedocs.io/en/stable/index.html">openpyxl</a>:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">janitor</span> <span class="kn">import</span> <span class="n">xlsx_cells</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">xlsx_cells</span><span class="p">(</span><span class="n">excel_file</span><span class="p">,</span> <span class="n">sheetnames</span><span class="o">=</span><span class="s1">'pivot-annotations'</span><span class="p">,</span> <span class="n">include_blank_cells</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># the colours are stored in a dictionary form in a cell</span>
<span class="c1"># using Pandas' string functions make it easy to traverse</span>
<span class="c1"># and pick the exact metadata we are interested in.</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'fill_colour'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">fill</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'fgColor'</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'rgb'</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
      <th>internal_value</th>
      <th>coordinate</th>
      <th>row</th>
      <th>column</th>
      <th>data_type</th>
      <th>is_date</th>
      <th>number_format</th>
      <th>fill</th>
      <th>fill_colour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Female</td>
      <td>Female</td>
      <td>D2</td>
      <td>2</td>
      <td>4</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Male</td>
      <td>Male</td>
      <td>F2</td>
      <td>2</td>
      <td>6</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Matilda</td>
      <td>Matilda</td>
      <td>D3</td>
      <td>3</td>
      <td>4</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Olivia</td>
      <td>Olivia</td>
      <td>E3</td>
      <td>3</td>
      <td>5</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Nicholas</td>
      <td>Nicholas</td>
      <td>F3</td>
      <td>3</td>
      <td>6</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Paul</td>
      <td>Paul</td>
      <td>G3</td>
      <td>3</td>
      <td>7</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Humanities</td>
      <td>Humanities</td>
      <td>B4</td>
      <td>4</td>
      <td>2</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Classics</td>
      <td>Classics</td>
      <td>C4</td>
      <td>4</td>
      <td>3</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>1</td>
      <td>D4</td>
      <td>4</td>
      <td>4</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2</td>
      <td>2</td>
      <td>E4</td>
      <td>4</td>
      <td>5</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': 'solid', 'fgColor': {'rgb': 'F...</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th>10</th>
      <td>3</td>
      <td>3</td>
      <td>F4</td>
      <td>4</td>
      <td>6</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0</td>
      <td>0</td>
      <td>G4</td>
      <td>4</td>
      <td>7</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>History</td>
      <td>History</td>
      <td>C5</td>
      <td>5</td>
      <td>3</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>3</td>
      <td>3</td>
      <td>D5</td>
      <td>5</td>
      <td>4</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': 'solid', 'fgColor': {'rgb': 'F...</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th>14</th>
      <td>4</td>
      <td>4</td>
      <td>E5</td>
      <td>5</td>
      <td>5</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>5</td>
      <td>5</td>
      <td>F5</td>
      <td>5</td>
      <td>6</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1</td>
      <td>1</td>
      <td>G5</td>
      <td>5</td>
      <td>7</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Performance</td>
      <td>Performance</td>
      <td>B6</td>
      <td>6</td>
      <td>2</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Music</td>
      <td>Music</td>
      <td>C6</td>
      <td>6</td>
      <td>3</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>19</th>
      <td>5</td>
      <td>5</td>
      <td>D6</td>
      <td>6</td>
      <td>4</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>20</th>
      <td>6</td>
      <td>6</td>
      <td>E6</td>
      <td>6</td>
      <td>5</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>21</th>
      <td>9</td>
      <td>9</td>
      <td>F6</td>
      <td>6</td>
      <td>6</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2</td>
      <td>2</td>
      <td>G6</td>
      <td>6</td>
      <td>7</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Drama</td>
      <td>Drama</td>
      <td>C7</td>
      <td>7</td>
      <td>3</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>24</th>
      <td>7</td>
      <td>7</td>
      <td>D7</td>
      <td>7</td>
      <td>4</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>25</th>
      <td>8</td>
      <td>8</td>
      <td>E7</td>
      <td>7</td>
      <td>5</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>26</th>
      <td>12</td>
      <td>12</td>
      <td>F7</td>
      <td>7</td>
      <td>6</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': 'solid', 'fgColor': {'rgb': 'F...</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th>27</th>
      <td>3</td>
      <td>3</td>
      <td>G7</td>
      <td>7</td>
      <td>7</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'patternType': None, 'fgColor': {'rgb': '0000...</td>
      <td>00000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>From the excel file we can tell that the <code>fields</code> and <code>subjects</code> columns are columns 2 and 3 respectively, the <code>gender</code> row is 2, while the <code>students</code> are on row 3:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="p">[</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">'row'</span><span class="p">,</span> <span class="s1">'column'</span><span class="p">]]</span>
<span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span>
        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">fields</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> 
                <span class="n">subjects</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">))</span>
        <span class="o">.</span><span class="n">fill_direction</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="s1">'down'</span><span class="p">)</span>
        <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">'value'</span><span class="p">)</span>
        <span class="p">)</span>
<span class="n">index</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>row</th>
      <th>column</th>
      <th>fields</th>
      <th>subjects</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7</th>
      <td>4</td>
      <td>3</td>
      <td>Humanities</td>
      <td>Classics</td>
    </tr>
    <tr>
      <th>12</th>
      <td>5</td>
      <td>3</td>
      <td>Humanities</td>
      <td>History</td>
    </tr>
    <tr>
      <th>18</th>
      <td>6</td>
      <td>3</td>
      <td>Performance</td>
      <td>Music</td>
    </tr>
    <tr>
      <th>23</th>
      <td>7</td>
      <td>3</td>
      <td>Performance</td>
      <td>Drama</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">row</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="p">[</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">'row'</span><span class="p">,</span> <span class="s1">'column'</span><span class="p">]]</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="n">columns</span>
            <span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">'column'</span><span class="p">])</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">gender</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">row</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">df</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> 
                    <span class="n">students</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gender</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">))</span>
            <span class="o">.</span><span class="n">fill_direction</span><span class="p">(</span><span class="n">gender</span><span class="o">=</span><span class="s1">'down'</span><span class="p">)</span>
            <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">'value'</span><span class="p">)</span>
        <span class="p">)</span>
<span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>row</th>
      <th>column</th>
      <th>gender</th>
      <th>students</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>4</td>
      <td>Female</td>
      <td>Matilda</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>5</td>
      <td>Female</td>
      <td>Olivia</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>6</td>
      <td>Male</td>
      <td>Nicholas</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>7</td>
      <td>Male</td>
      <td>Paul</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span>
        <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="s1">'n'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">'row'</span><span class="p">,</span> <span class="s1">'column'</span><span class="p">,</span> <span class="s1">'fill_colour'</span><span class="p">]]</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'value'</span><span class="p">:</span><span class="s1">'scores'</span><span class="p">})</span>
        <span class="p">)</span>
<span class="n">scores</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>scores</th>
      <th>row</th>
      <th>column</th>
      <th>fill_colour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>4</td>
      <td>4</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2</td>
      <td>4</td>
      <td>5</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th>10</th>
      <td>3</td>
      <td>4</td>
      <td>6</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0</td>
      <td>4</td>
      <td>7</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>3</td>
      <td>5</td>
      <td>4</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th>14</th>
      <td>4</td>
      <td>5</td>
      <td>5</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>5</td>
      <td>5</td>
      <td>6</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1</td>
      <td>5</td>
      <td>7</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>19</th>
      <td>5</td>
      <td>6</td>
      <td>4</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>20</th>
      <td>6</td>
      <td>6</td>
      <td>5</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>21</th>
      <td>9</td>
      <td>6</td>
      <td>6</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2</td>
      <td>6</td>
      <td>7</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>24</th>
      <td>7</td>
      <td>7</td>
      <td>4</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>25</th>
      <td>8</td>
      <td>7</td>
      <td>5</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>26</th>
      <td>12</td>
      <td>7</td>
      <td>6</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th>27</th>
      <td>3</td>
      <td>7</td>
      <td>7</td>
      <td>00000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All that's left is to align them on their row and column positions:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">index</span>
<span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">'column'</span><span class="p">)</span>
<span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">'row'</span><span class="p">)</span>
<span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">'row'</span><span class="p">),</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">'column'</span><span class="p">)</span>
<span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">'students'</span><span class="p">,</span> <span class="s1">'gender'</span><span class="p">,</span> <span class="s1">'fields'</span><span class="p">,</span> <span class="s1">'subjects'</span><span class="p">,</span> <span class="s1">'scores'</span><span class="p">,</span> <span class="s1">'fill_colour'</span><span class="p">]]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>students</th>
      <th>gender</th>
      <th>fields</th>
      <th>subjects</th>
      <th>scores</th>
      <th>fill_colour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Matilda</td>
      <td>Female</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>1</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Matilda</td>
      <td>Female</td>
      <td>Humanities</td>
      <td>History</td>
      <td>3</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Matilda</td>
      <td>Female</td>
      <td>Performance</td>
      <td>Music</td>
      <td>5</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Matilda</td>
      <td>Female</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>7</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Olivia</td>
      <td>Female</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>2</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Olivia</td>
      <td>Female</td>
      <td>Humanities</td>
      <td>History</td>
      <td>4</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Olivia</td>
      <td>Female</td>
      <td>Performance</td>
      <td>Music</td>
      <td>6</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Olivia</td>
      <td>Female</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>8</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Nicholas</td>
      <td>Male</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>3</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Nicholas</td>
      <td>Male</td>
      <td>Humanities</td>
      <td>History</td>
      <td>5</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Nicholas</td>
      <td>Male</td>
      <td>Performance</td>
      <td>Music</td>
      <td>9</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Nicholas</td>
      <td>Male</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>12</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Paul</td>
      <td>Male</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>0</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Paul</td>
      <td>Male</td>
      <td>Humanities</td>
      <td>History</td>
      <td>1</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Paul</td>
      <td>Male</td>
      <td>Performance</td>
      <td>Music</td>
      <td>2</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Paul</td>
      <td>Male</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>3</td>
      <td>00000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Case-3-:-Mixed-headers-and-notes-in-the-same-row/column,-distinguished-by-formatting">
<a class="anchor" href="#Case-3-:-Mixed-headers-and-notes-in-the-same-row/column,-distinguished-by-formatting" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Case 3 : Mixed headers and notes in the same row/column, distinguished by formatting</strong><a class="anchor-link" href="#Case-3-:-Mixed-headers-and-notes-in-the-same-row/column,-distinguished-by-formatting"> </a>
</h3>
<p><img src="/data-wrangling-blog/images/copied_from_nb/Images/pivot-notes.png" alt="pivot-notes.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this case, the <font color="red">highlighted texts</font> should be excluded, as they are just notes and not relevant. Same goes for the 0=absent in G2 cell, which is <em>italicized</em>. red is identifed as <code>FFFF0000</code>, while italics should return True if it exists.</p>
<p>We'll use the same steps as in the last solution:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">xlsx_cells</span><span class="p">(</span><span class="n">excel_file</span><span class="p">,</span> <span class="n">sheetnames</span><span class="o">=</span><span class="s1">'pivot-notes'</span><span class="p">,</span> <span class="n">include_blank_cells</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can view a single row in the font column:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{'name': 'Calibri',
 'family': 2.0,
 'sz': 11.0,
 'b': False,
 'i': False,
 'u': None,
 'strike': None,
 'color': {'rgb': 'FF000000', 'type': 'rgb', 'tint': 0.0},
 'vertAlign': None,
 'charset': 1,
 'outline': None,
 'shadow': None,
 'condense': None,
 'extend': None,
 'scheme': None}</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">font_colour</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'color'</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'rgb'</span><span class="p">),</span> <span class="n">italics</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'i'</span><span class="p">))</span>
<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
      <th>internal_value</th>
      <th>coordinate</th>
      <th>row</th>
      <th>column</th>
      <th>data_type</th>
      <th>is_date</th>
      <th>number_format</th>
      <th>font</th>
      <th>font_colour</th>
      <th>italics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Female</td>
      <td>Female</td>
      <td>D2</td>
      <td>2</td>
      <td>4</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Male</td>
      <td>Male</td>
      <td>F2</td>
      <td>2</td>
      <td>6</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0 = absent</td>
      <td>0 = absent</td>
      <td>G2</td>
      <td>2</td>
      <td>7</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Matilda</td>
      <td>Matilda</td>
      <td>D3</td>
      <td>3</td>
      <td>4</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Olivia</td>
      <td>Olivia</td>
      <td>E3</td>
      <td>3</td>
      <td>5</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Nicholas</td>
      <td>Nicholas</td>
      <td>F3</td>
      <td>3</td>
      <td>6</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Paul</td>
      <td>Paul</td>
      <td>G3</td>
      <td>3</td>
      <td>7</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Humanities</td>
      <td>Humanities</td>
      <td>B4</td>
      <td>4</td>
      <td>2</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Classics</td>
      <td>Classics</td>
      <td>C4</td>
      <td>4</td>
      <td>3</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>1</td>
      <td>D4</td>
      <td>4</td>
      <td>4</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2</td>
      <td>2</td>
      <td>E4</td>
      <td>4</td>
      <td>5</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>11</th>
      <td>3</td>
      <td>3</td>
      <td>F4</td>
      <td>4</td>
      <td>6</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0</td>
      <td>0</td>
      <td>G4</td>
      <td>4</td>
      <td>7</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Excl. project work</td>
      <td>Excl. project work</td>
      <td>B5</td>
      <td>5</td>
      <td>2</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FFFF0000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>14</th>
      <td>History</td>
      <td>History</td>
      <td>C5</td>
      <td>5</td>
      <td>3</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>15</th>
      <td>3</td>
      <td>3</td>
      <td>D5</td>
      <td>5</td>
      <td>4</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>16</th>
      <td>4</td>
      <td>4</td>
      <td>E5</td>
      <td>5</td>
      <td>5</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>17</th>
      <td>5</td>
      <td>5</td>
      <td>F5</td>
      <td>5</td>
      <td>6</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1</td>
      <td>1</td>
      <td>G5</td>
      <td>5</td>
      <td>7</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Performance</td>
      <td>Performance</td>
      <td>B6</td>
      <td>6</td>
      <td>2</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Music</td>
      <td>Music</td>
      <td>C6</td>
      <td>6</td>
      <td>3</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>21</th>
      <td>5</td>
      <td>5</td>
      <td>D6</td>
      <td>6</td>
      <td>4</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>22</th>
      <td>6</td>
      <td>6</td>
      <td>E6</td>
      <td>6</td>
      <td>5</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>23</th>
      <td>9</td>
      <td>9</td>
      <td>F6</td>
      <td>6</td>
      <td>6</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2</td>
      <td>2</td>
      <td>G6</td>
      <td>6</td>
      <td>7</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Incl. written exam</td>
      <td>Incl. written exam</td>
      <td>B7</td>
      <td>7</td>
      <td>2</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FFFF0000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Drama</td>
      <td>Drama</td>
      <td>C7</td>
      <td>7</td>
      <td>3</td>
      <td>s</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>27</th>
      <td>7</td>
      <td>7</td>
      <td>D7</td>
      <td>7</td>
      <td>4</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>28</th>
      <td>8</td>
      <td>8</td>
      <td>E7</td>
      <td>7</td>
      <td>5</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>29</th>
      <td>12</td>
      <td>12</td>
      <td>F7</td>
      <td>7</td>
      <td>6</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>30</th>
      <td>3</td>
      <td>3</td>
      <td>G7</td>
      <td>7</td>
      <td>7</td>
      <td>n</td>
      <td>False</td>
      <td>General</td>
      <td>{'name': 'Calibri', 'family': 2.0, 'sz': 11.0,...</td>
      <td>FF000000</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="p">[</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">'row'</span><span class="p">,</span> <span class="s1">'column'</span><span class="p">,</span> <span class="s1">'font_colour'</span><span class="p">]]</span>
<span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span>
        <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">font_colour</span><span class="o">.</span><span class="n">ne</span><span class="p">(</span><span class="s1">'FFFF0000'</span><span class="p">)]</span>
        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">fields</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">df</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> 
                <span class="n">subjects</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">))</span>        
        <span class="o">.</span><span class="n">fill_direction</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="s1">'down'</span><span class="p">)</span>
        <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">'font_colour'</span><span class="p">])</span>
        <span class="p">)</span>
<span class="n">index</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>row</th>
      <th>column</th>
      <th>fields</th>
      <th>subjects</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>4</td>
      <td>3</td>
      <td>Humanities</td>
      <td>Classics</td>
    </tr>
    <tr>
      <th>14</th>
      <td>5</td>
      <td>3</td>
      <td>Humanities</td>
      <td>History</td>
    </tr>
    <tr>
      <th>20</th>
      <td>6</td>
      <td>3</td>
      <td>Performance</td>
      <td>Music</td>
    </tr>
    <tr>
      <th>26</th>
      <td>7</td>
      <td>3</td>
      <td>Performance</td>
      <td>Drama</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">row</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="p">[</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">'row'</span><span class="p">,</span> <span class="s1">'column'</span><span class="p">,</span> <span class="s1">'italics'</span><span class="p">]]</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="n">columns</span>
            <span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">'column'</span><span class="p">])</span>
            <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">italics</span><span class="p">]</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">gender</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">row</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">df</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> 
                    <span class="n">students</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gender</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">))</span>
            <span class="o">.</span><span class="n">fill_direction</span><span class="p">(</span><span class="n">gender</span> <span class="o">=</span> <span class="s1">'down'</span><span class="p">)</span>
            <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">'italics'</span><span class="p">])</span>
        <span class="p">)</span>
<span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>row</th>
      <th>column</th>
      <th>gender</th>
      <th>students</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>4</td>
      <td>Female</td>
      <td>Matilda</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>5</td>
      <td>Female</td>
      <td>Olivia</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>6</td>
      <td>Male</td>
      <td>Nicholas</td>
    </tr>
    <tr>
      <th>6</th>
      <td>3</td>
      <td>7</td>
      <td>Male</td>
      <td>Paul</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span>
        <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="s1">'n'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">'row'</span><span class="p">,</span> <span class="s1">'column'</span><span class="p">]]</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'value'</span><span class="p">:</span><span class="s1">'scores'</span><span class="p">})</span>
        <span class="p">)</span>
<span class="n">scores</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>scores</th>
      <th>row</th>
      <th>column</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2</td>
      <td>4</td>
      <td>5</td>
    </tr>
    <tr>
      <th>11</th>
      <td>3</td>
      <td>4</td>
      <td>6</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0</td>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>15</th>
      <td>3</td>
      <td>5</td>
      <td>4</td>
    </tr>
    <tr>
      <th>16</th>
      <td>4</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>17</th>
      <td>5</td>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1</td>
      <td>5</td>
      <td>7</td>
    </tr>
    <tr>
      <th>21</th>
      <td>5</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>22</th>
      <td>6</td>
      <td>6</td>
      <td>5</td>
    </tr>
    <tr>
      <th>23</th>
      <td>9</td>
      <td>6</td>
      <td>6</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2</td>
      <td>6</td>
      <td>7</td>
    </tr>
    <tr>
      <th>27</th>
      <td>7</td>
      <td>7</td>
      <td>4</td>
    </tr>
    <tr>
      <th>28</th>
      <td>8</td>
      <td>7</td>
      <td>5</td>
    </tr>
    <tr>
      <th>29</th>
      <td>12</td>
      <td>7</td>
      <td>6</td>
    </tr>
    <tr>
      <th>30</th>
      <td>3</td>
      <td>7</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">index</span>
<span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">'column'</span><span class="p">)</span>
<span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">'row'</span><span class="p">)</span>
<span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">'row'</span><span class="p">),</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">'column'</span><span class="p">)</span>
<span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">'students'</span><span class="p">,</span> <span class="s1">'gender'</span><span class="p">,</span> <span class="s1">'fields'</span><span class="p">,</span> <span class="s1">'subjects'</span><span class="p">,</span> <span class="s1">'scores'</span><span class="p">]]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>students</th>
      <th>gender</th>
      <th>fields</th>
      <th>subjects</th>
      <th>scores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Matilda</td>
      <td>Female</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Matilda</td>
      <td>Female</td>
      <td>Humanities</td>
      <td>History</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Matilda</td>
      <td>Female</td>
      <td>Performance</td>
      <td>Music</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Matilda</td>
      <td>Female</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>7</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Olivia</td>
      <td>Female</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Olivia</td>
      <td>Female</td>
      <td>Humanities</td>
      <td>History</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Olivia</td>
      <td>Female</td>
      <td>Performance</td>
      <td>Music</td>
      <td>6</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Olivia</td>
      <td>Female</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>8</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Nicholas</td>
      <td>Male</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>3</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Nicholas</td>
      <td>Male</td>
      <td>Humanities</td>
      <td>History</td>
      <td>5</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Nicholas</td>
      <td>Male</td>
      <td>Performance</td>
      <td>Music</td>
      <td>9</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Nicholas</td>
      <td>Male</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>12</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Paul</td>
      <td>Male</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Paul</td>
      <td>Male</td>
      <td>Humanities</td>
      <td>History</td>
      <td>1</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Paul</td>
      <td>Male</td>
      <td>Performance</td>
      <td>Music</td>
      <td>2</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Paul</td>
      <td>Male</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Case-4:-Mixed-levels-of-headers-in-the-same-row/column,-distinguished-by-formatting">
<a class="anchor" href="#Case-4:-Mixed-levels-of-headers-in-the-same-row/column,-distinguished-by-formatting" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Case 4: Mixed levels of headers in the same row/column, distinguished by formatting</strong><a class="anchor-link" href="#Case-4:-Mixed-levels-of-headers-in-the-same-row/column,-distinguished-by-formatting"> </a>
</h3>
<p><img src="/data-wrangling-blog/images/copied_from_nb/Images/pivot-hierarchy.png" alt="pivot-hierarchy.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The formatting here refers to the indent - notice how Humanities and Performance are closer to the border compared to the subjects. Same goes for Matilda and Nicholas. Getting the indent information would require the use of Openpyxl. This data can however be handled easily by Pandas - for the header columns, we can use the adjacent null cells as identifiers:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">excel_file</span>
<span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sheet_name</span><span class="o">=</span><span class="s1">'pivot-hierarchy'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">.</span><span class="n">remove_empty</span><span class="p">()</span>
<span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">fields</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
        <span class="n">subjects</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="p">)</span>
<span class="o">.</span><span class="n">fill_direction</span><span class="p">(</span><span class="n">fields</span> <span class="o">=</span> <span class="s1">'down'</span><span class="p">)</span>
<span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
<span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'fields'</span><span class="p">,</span> <span class="s1">'subjects'</span><span class="p">],</span> <span class="n">var_name</span> <span class="o">=</span> <span class="s1">'students'</span><span class="p">,</span> <span class="n">value_name</span> <span class="o">=</span> <span class="s1">'scores'</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fields</th>
      <th>subjects</th>
      <th>students</th>
      <th>scores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Matilda</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Matilda</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Matilda</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Matilda</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Nicholas</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Nicholas</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Nicholas</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Nicholas</td>
      <td>12.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="samukweku/data-wrangling-blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/data-wrangling-blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/data-wrangling-blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/data-wrangling-blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Data Wrangling Blog.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/samukweku" target="_blank" title="samukweku"><svg class="svg-icon grey"><use xlink:href="/data-wrangling-blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/samukweku" target="_blank" title="samukweku"><svg class="svg-icon grey"><use xlink:href="/data-wrangling-blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
