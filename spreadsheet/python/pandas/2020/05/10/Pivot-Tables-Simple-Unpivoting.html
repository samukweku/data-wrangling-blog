<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting | Samuel Oranyeli</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Extract data from pivot tables in a spreadsheet" />
<meta property="og:description" content="Extract data from pivot tables in a spreadsheet" />
<link rel="canonical" href="https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html" />
<meta property="og:url" content="https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html" />
<meta property="og:site_name" content="Samuel Oranyeli" />
<meta property="og:image" content="https://samukweku.github.io/data-wrangling-blog/images/some_folder/your_image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-10T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Extract data from pivot tables in a spreadsheet","@type":"BlogPosting","headline":"SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting","url":"https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html","datePublished":"2020-05-10T00:00:00-05:00","dateModified":"2020-05-10T00:00:00-05:00","image":"https://samukweku.github.io/data-wrangling-blog/images/some_folder/your_image.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/data-wrangling-blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://samukweku.github.io/data-wrangling-blog/feed.xml" title="Samuel Oranyeli" /><link rel="shortcut icon" type="image/x-icon" href="/data-wrangling-blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting | Samuel Oranyeli</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Extract data from pivot tables in a spreadsheet" />
<meta property="og:description" content="Extract data from pivot tables in a spreadsheet" />
<link rel="canonical" href="https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html" />
<meta property="og:url" content="https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html" />
<meta property="og:site_name" content="Samuel Oranyeli" />
<meta property="og:image" content="https://samukweku.github.io/data-wrangling-blog/images/some_folder/your_image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-10T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Extract data from pivot tables in a spreadsheet","@type":"BlogPosting","headline":"SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting","url":"https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html","datePublished":"2020-05-10T00:00:00-05:00","dateModified":"2020-05-10T00:00:00-05:00","image":"https://samukweku.github.io/data-wrangling-blog/images/some_folder/your_image.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://samukweku.github.io/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://samukweku.github.io/data-wrangling-blog/feed.xml" title="Samuel Oranyeli" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
<script type="text/javascript">
require.config({
  paths: {
    jquery: 'https://code.jquery.com/jquery-3.5.0.min',
    plotly: 'https://cdn.plot.ly/plotly-latest.min'
  },

  shim: {
    plotly: {
      deps: ['jquery'],
      exports: 'plotly'
    }
  }
});
</script>

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/data-wrangling-blog/">Samuel Oranyeli</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/data-wrangling-blog/about/">About Me</a><a class="page-link" href="/data-wrangling-blog/search/">Search</a><a class="page-link" href="/data-wrangling-blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SpreadSheet Munging Strategies in Python - Pivot Tables - Simple Unpivoting</h1><p class="page-description">Extract data from pivot tables in a spreadsheet</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-05-10T00:00:00-05:00" itemprop="datePublished">
        May 10, 2020
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/data-wrangling-blog/categories/#Spreadsheet">Spreadsheet</a>
        &nbsp;
      
        <a class="category-tags-link" href="/data-wrangling-blog/categories/#Python">Python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/data-wrangling-blog/categories/#Pandas">Pandas</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/samukweku/data-wrangling-blog/tree/master/_notebooks/2020-05-10-Pivot Tables - Simple Unpivoting.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/data-wrangling-blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Pivot-Tables---Simple-Unpivoting">Pivot Tables - Simple Unpivoting </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Case-1:-Multiple-Row-and-Column-headers">Case 1: Multiple Row and Column headers </a></li>
<li class="toc-entry toc-h3"><a href="#Case-2-:-Multiple-rows-or-columns-of-headers,-with-meaningful-formatting">Case 2 : Multiple rows or columns of headers, with meaningful formatting </a></li>
<li class="toc-entry toc-h3"><a href="#Case-3-:-Mixed-headers-and-notes-in-the-same-row/column,-distinguished-by-formatting">Case 3 : Mixed headers and notes in the same row/column, distinguished by formatting </a></li>
<li class="toc-entry toc-h3"><a href="#Case-4:-Mixed-levels-of-headers-in-the-same-row/column,-distinguished-by-formatting">Case 4: Mixed levels of headers in the same row/column, distinguished by formatting </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-05-10-Pivot Tables - Simple Unpivoting.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Pivot-Tables---Simple-Unpivoting">
<a class="anchor" href="#Pivot-Tables---Simple-Unpivoting" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Pivot Tables - Simple Unpivoting</strong><a class="anchor-link" href="#Pivot-Tables---Simple-Unpivoting"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is part of a series of blog posts about extracting data from spreadsheets using Python.  It is based on the <a href="https://nacnudus.github.io/spreadsheet-munging-strategies/index.html">book</a> written by <a href="https://twitter.com/nacnudus?lang=en">Duncan Garmonsway</a>, which was written primarily for R users. LInks to the other posts are on the <a href="https://samukweku.github.io/data-wrangling-blog/">homepage</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Pivot tables offer a summarized version of the data, and are usually succinct and visually appealing. However, for analysis, it is not so good. How do we convert pivot tables to tidy data? This section covers that. We'll see various kinds of pivot tables, and work through each of them.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">"Data_files/worked-examples.xlsx"</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Case-1:-Multiple-Row-and-Column-headers">
<a class="anchor" href="#Case-1:-Multiple-Row-and-Column-headers" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Case 1: Multiple Row and Column headers</strong><a class="anchor-link" href="#Case-1:-Multiple-Row-and-Column-headers"> </a>
</h3>
<p><img src="/data-wrangling-blog/images/copied_from_nb/Images/pivot-annotations.png" alt="pivot-annotations.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/data-wrangling-blog/images/copied_from_nb/Images/formattedrowsandcolumns.jpg" alt="pivot-annotations-headerrowandcolumn.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Observations</strong>:</p>
<ol>
<li>There are two header rows - gender and names.</li>
<li>There are also two header columns on the left - Fields(Humanities, Performance) and Subjects(Classics, History, ...)</li>
<li>For this case we wont be concerned with the colour formats. We'll look at that in a later section.</li>
</ol>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sheet</span> <span class="o">=</span> <span class="s1">'pivot-annotations'</span>

<span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> 
                    <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">,</span>
                    <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">)</span>
      <span class="c1">#get rid of completely null columns and rows</span>
      <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">'all'</span><span class="p">)</span>
      <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">'all'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="c1">#fill sideways on the gender</span>
      <span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="c1">#fill downwards on the fields column</span>
      <span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
      <span class="c1">#set index to the first two columns - the header columns</span>
      <span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
     <span class="p">)</span>

<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
    </tr>
    <tr>
      <th>1</th>
      <th>2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">NaN</th>
      <th>NaN</th>
      <td>Female</td>
      <td>Female</td>
      <td>Male</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>NaN</th>
      <td>Matilda</td>
      <td>Olivia</td>
      <td>Nicholas</td>
      <td>Paul</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Humanities</th>
      <th>Classics</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>History</th>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Performance</th>
      <th>Music</th>
      <td>5</td>
      <td>6</td>
      <td>9</td>
      <td>2</td>
    </tr>
    <tr>
      <th>Drama</th>
      <td>7</td>
      <td>8</td>
      <td>12</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#set the columns to the first two rows - the header rows</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">set_names</span><span class="p">([</span><span class="s1">'gender'</span><span class="p">,</span><span class="s1">'student'</span><span class="p">])</span>

<span class="c1">#final cleanup to tidy form</span>

       <span class="c1">#get rid of the first two rows</span>
       <span class="c1">#they are already headers,</span>
       <span class="c1">#so not needed within the dataframe</span>
<span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> 
       <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">'field'</span><span class="p">,</span> <span class="s1">'subject'</span><span class="p">])</span>
       <span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="s1">'gender'</span><span class="p">,</span> <span class="s1">'student'</span><span class="p">])</span>
       <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'scores'</span><span class="p">)</span>
      <span class="p">)</span>

<span class="n">res</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>field</th>
      <th>subject</th>
      <th>gender</th>
      <th>student</th>
      <th>scores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Female</td>
      <td>Matilda</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Female</td>
      <td>Olivia</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Male</td>
      <td>Nicholas</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Male</td>
      <td>Paul</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Female</td>
      <td>Matilda</td>
      <td>3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Female</td>
      <td>Olivia</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Male</td>
      <td>Nicholas</td>
      <td>5</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Male</td>
      <td>Paul</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Female</td>
      <td>Matilda</td>
      <td>5</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Female</td>
      <td>Olivia</td>
      <td>6</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Male</td>
      <td>Nicholas</td>
      <td>9</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Male</td>
      <td>Paul</td>
      <td>2</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Female</td>
      <td>Matilda</td>
      <td>7</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Female</td>
      <td>Olivia</td>
      <td>8</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Male</td>
      <td>Nicholas</td>
      <td>12</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Male</td>
      <td>Paul</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Case-2-:-Multiple-rows-or-columns-of-headers,-with-meaningful-formatting">
<a class="anchor" href="#Case-2-:-Multiple-rows-or-columns-of-headers,-with-meaningful-formatting" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Case 2 : Multiple rows or columns of headers, with meaningful formatting</strong><a class="anchor-link" href="#Case-2-:-Multiple-rows-or-columns-of-headers,-with-meaningful-formatting"> </a>
</h3>
<p><img src="/data-wrangling-blog/images/copied_from_nb/Images/pivot-annotations.png" alt="pivot-annotations.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Same as above, except we have to capture the format details. To get these details, we'll make use of another library - <a href="https://openpyxl.readthedocs.io/en/stable/index.html">Openpyxl</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># read in file and sheet</span>
<span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">load_workbook</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="p">[</span><span class="s2">"pivot-annotations"</span><span class="p">]</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="c1">#Iterate through each row in the sheet and get the details</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ws</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">min_row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">max_row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span><span class="p">,</span>
                        <span class="n">min_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">max_col</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_column</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
        <span class="c1">#if the data type is number format, lump the cell value with the cell color</span>
        <span class="c1">#this is because only the cells with numbers are formatted</span>
        <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="s2">"n"</span> <span class="ow">and</span> <span class="n">cell</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">cell</span><span class="o">.</span><span class="n">fill</span><span class="o">.</span><span class="n">fgColor</span><span class="o">.</span><span class="n">rgb</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">value</span>
        <span class="n">d</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#view the dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>   

<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>Humanities</td>
      <td>None</td>
      <td>Performance</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>Classics</td>
      <td>History</td>
      <td>Music</td>
      <td>Drama</td>
    </tr>
    <tr>
      <th>3</th>
      <td>None</td>
      <td>Female</td>
      <td>Matilda</td>
      <td>1,00000000</td>
      <td>3,FFFFFF00</td>
      <td>5,00000000</td>
      <td>7,00000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>None</td>
      <td>None</td>
      <td>Olivia</td>
      <td>2,FFFFFF00</td>
      <td>4,00000000</td>
      <td>6,00000000</td>
      <td>8,00000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>None</td>
      <td>Male</td>
      <td>Nicholas</td>
      <td>3,00000000</td>
      <td>5,00000000</td>
      <td>9,00000000</td>
      <td>12,FFFFFF00</td>
    </tr>
    <tr>
      <th>6</th>
      <td>None</td>
      <td>None</td>
      <td>Paul</td>
      <td>0,00000000</td>
      <td>1,00000000</td>
      <td>2,00000000</td>
      <td>3,00000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our data is quite similar to the data in case 1, except for the fact that the scores have colour values. Let's proceed to clean up the data into a tidy form:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span>
      <span class="c1">#remove complete nulls, column and row wise</span>
      <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">'all'</span><span class="p">)</span>
      <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">'all'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
      <span class="c1">#set the first two rows as the header columns</span>
      <span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
     <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
    </tr>
    <tr>
      <th>2</th>
      <th>3</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">NaN</th>
      <th>NaN</th>
      <td>Humanities</td>
      <td>Humanities</td>
      <td>Performance</td>
      <td>Performance</td>
    </tr>
    <tr>
      <th>NaN</th>
      <td>Classics</td>
      <td>History</td>
      <td>Music</td>
      <td>Drama</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Female</th>
      <th>Matilda</th>
      <td>1,00000000</td>
      <td>3,FFFFFF00</td>
      <td>5,00000000</td>
      <td>7,00000000</td>
    </tr>
    <tr>
      <th>Olivia</th>
      <td>2,FFFFFF00</td>
      <td>4,00000000</td>
      <td>6,00000000</td>
      <td>8,00000000</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Male</th>
      <th>Nicholas</th>
      <td>3,00000000</td>
      <td>5,00000000</td>
      <td>9,00000000</td>
      <td>12,FFFFFF00</td>
    </tr>
    <tr>
      <th>Paul</th>
      <td>0,00000000</td>
      <td>1,00000000</td>
      <td>2,00000000</td>
      <td>3,00000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#more cleanup</span>

<span class="c1">#set the first two rows as the header row</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">set_names</span><span class="p">([</span><span class="s1">'field'</span><span class="p">,</span><span class="s1">'subject'</span><span class="p">])</span>

<span class="c1">#final cleanup to tidy form</span>

<span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> 
       <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">'gender'</span><span class="p">,</span> <span class="s1">'student'</span><span class="p">])</span>
       <span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="s1">'field'</span><span class="p">,</span> <span class="s1">'subject'</span><span class="p">])</span>
       <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#breaks it into separate columns - scores and colours</span>
       <span class="o">.</span><span class="n">set_axis</span><span class="p">([</span><span class="s1">'scores'</span><span class="p">,</span><span class="s1">'fill_colour'</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#replace column names</span>
       <span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">'scores'</span><span class="p">:</span><span class="s1">'int8'</span><span class="p">})</span>
      <span class="p">)</span>

<span class="n">res</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>scores</th>
      <th>fill_colour</th>
    </tr>
    <tr>
      <th>gender</th>
      <th>student</th>
      <th>field</th>
      <th>subject</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="8" valign="top">Female</th>
      <th rowspan="4" valign="top">Matilda</th>
      <th rowspan="2" valign="top">Humanities</th>
      <th>Classics</th>
      <td>1</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>History</th>
      <td>3</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Performance</th>
      <th>Drama</th>
      <td>7</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>Music</th>
      <td>5</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">Olivia</th>
      <th rowspan="2" valign="top">Humanities</th>
      <th>Classics</th>
      <td>2</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th>History</th>
      <td>4</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Performance</th>
      <th>Drama</th>
      <td>8</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>Music</th>
      <td>6</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th rowspan="8" valign="top">Male</th>
      <th rowspan="4" valign="top">Nicholas</th>
      <th rowspan="2" valign="top">Humanities</th>
      <th>Classics</th>
      <td>3</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>History</th>
      <td>5</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Performance</th>
      <th>Drama</th>
      <td>12</td>
      <td>FFFFFF00</td>
    </tr>
    <tr>
      <th>Music</th>
      <td>9</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">Paul</th>
      <th rowspan="2" valign="top">Humanities</th>
      <th>Classics</th>
      <td>0</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>History</th>
      <td>1</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Performance</th>
      <th>Drama</th>
      <td>3</td>
      <td>00000000</td>
    </tr>
    <tr>
      <th>Music</th>
      <td>2</td>
      <td>00000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Case-3-:-Mixed-headers-and-notes-in-the-same-row/column,-distinguished-by-formatting">
<a class="anchor" href="#Case-3-:-Mixed-headers-and-notes-in-the-same-row/column,-distinguished-by-formatting" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Case 3 : Mixed headers and notes in the same row/column, distinguished by formatting</strong><a class="anchor-link" href="#Case-3-:-Mixed-headers-and-notes-in-the-same-row/column,-distinguished-by-formatting"> </a>
</h3>
<p><img src="/data-wrangling-blog/images/copied_from_nb/Images/pivot-notes.png" alt="pivot-notes.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this case, the <font color="red">highlighted texts</font> should be excluded, as they are just notes and not relevant. Same goes for the 0=absent in G2 cell, which is <em>italicized</em>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sheet</span> <span class="o">=</span> <span class="s2">"pivot-notes"</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ws</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">min_row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">max_row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span><span class="p">,</span>
                        <span class="n">min_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">max_col</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_column</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
         <span class="c1"># this excludes any cell that has a red font or is italicized </span>
        <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">rgb</span> <span class="o">==</span> <span class="s2">"FFFF0000"</span> <span class="ow">or</span> <span class="n">cell</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">i</span><span class="p">:</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">d</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>      
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>Humanities</td>
      <td>None</td>
      <td>Performance</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>Classics</td>
      <td>History</td>
      <td>Music</td>
      <td>Drama</td>
    </tr>
    <tr>
      <th>3</th>
      <td>None</td>
      <td>Female</td>
      <td>Matilda</td>
      <td>1</td>
      <td>3</td>
      <td>5</td>
      <td>7</td>
    </tr>
    <tr>
      <th>4</th>
      <td>None</td>
      <td>None</td>
      <td>Olivia</td>
      <td>2</td>
      <td>4</td>
      <td>6</td>
      <td>8</td>
    </tr>
    <tr>
      <th>5</th>
      <td>None</td>
      <td>Male</td>
      <td>Nicholas</td>
      <td>3</td>
      <td>5</td>
      <td>9</td>
      <td>12</td>
    </tr>
    <tr>
      <th>6</th>
      <td>None</td>
      <td>None</td>
      <td>Paul</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our data looks like case 2. Let's run through it and clean up</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span>
      <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">'all'</span><span class="p">)</span>
      <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">'all'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
      <span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
     <span class="p">)</span>


<span class="c1">#create multiIndex columns</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">set_names</span><span class="p">([</span><span class="s1">'field'</span><span class="p">,</span><span class="s1">'subject'</span><span class="p">])</span>

<span class="c1">#final cleanup to tidy form</span>

<span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> 
       <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">'gender'</span><span class="p">,</span> <span class="s1">'student'</span><span class="p">])</span>
       <span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="s1">'field'</span><span class="p">,</span> <span class="s1">'subject'</span><span class="p">])</span>
       <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'scores'</span><span class="p">)</span>
      <span class="p">)</span>

<span class="n">res</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>student</th>
      <th>field</th>
      <th>subject</th>
      <th>scores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Female</td>
      <td>Matilda</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Female</td>
      <td>Matilda</td>
      <td>Humanities</td>
      <td>History</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Female</td>
      <td>Matilda</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Female</td>
      <td>Matilda</td>
      <td>Performance</td>
      <td>Music</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Female</td>
      <td>Olivia</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Female</td>
      <td>Olivia</td>
      <td>Humanities</td>
      <td>History</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Female</td>
      <td>Olivia</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Female</td>
      <td>Olivia</td>
      <td>Performance</td>
      <td>Music</td>
      <td>6</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Male</td>
      <td>Nicholas</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>3</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Male</td>
      <td>Nicholas</td>
      <td>Humanities</td>
      <td>History</td>
      <td>5</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Male</td>
      <td>Nicholas</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>12</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Male</td>
      <td>Nicholas</td>
      <td>Performance</td>
      <td>Music</td>
      <td>9</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Male</td>
      <td>Paul</td>
      <td>Humanities</td>
      <td>Classics</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Male</td>
      <td>Paul</td>
      <td>Humanities</td>
      <td>History</td>
      <td>1</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Male</td>
      <td>Paul</td>
      <td>Performance</td>
      <td>Drama</td>
      <td>3</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Male</td>
      <td>Paul</td>
      <td>Performance</td>
      <td>Music</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Case-4:-Mixed-levels-of-headers-in-the-same-row/column,-distinguished-by-formatting">
<a class="anchor" href="#Case-4:-Mixed-levels-of-headers-in-the-same-row/column,-distinguished-by-formatting" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Case 4: Mixed levels of headers in the same row/column, distinguished by formatting</strong><a class="anchor-link" href="#Case-4:-Mixed-levels-of-headers-in-the-same-row/column,-distinguished-by-formatting"> </a>
</h3>
<p><img src="/data-wrangling-blog/images/copied_from_nb/Images/pivot-hierarchy.png" alt="pivot-hierarchy.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The formatting here refers to the indent - notice how Humanities and Performance are closer to the border compared to the subjects. Same goes for Matilda and Nicholas. Getting the indent information would require the use of Openpyxl. This data can however be handled easily by Pandas - for the header columns, we can use the adjacent null cells as identifiers:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">sheet_name</span><span class="o">=</span><span class="s2">"pivot-hierarchy"</span><span class="p">,</span>
                    <span class="n">header</span><span class="o">=</span><span class="kc">None</span>
                   <span class="p">)</span>
      <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">'all'</span><span class="p">)</span>
      <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">'all'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="c1">#extract the field column</span>
      <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">field</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">))</span>
      <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">field</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'field'</span><span class="p">]</span><span class="o">.</span><span class="n">ffill</span><span class="p">())</span>
      <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="c1">#replacement of null values for specific columns</span>
      <span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span><span class="s1">'subject'</span><span class="p">,</span> <span class="s1">'field'</span><span class="p">:</span><span class="s1">'field'</span><span class="p">})</span>
     <span class="p">)</span>

<span class="c1">#get the student names as part of the columns</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">#cleanup some more</span>
<span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span>
       <span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1">#first row not needed anymore</span>
       <span class="c1">#rearrange the dataframe by</span>
       <span class="c1">#getting the students as part of the data</span>
       <span class="c1">#essentially moving from wide to long format</span>
       <span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">'field'</span><span class="p">,</span> <span class="s1">'subject'</span><span class="p">],</span>
             <span class="n">var_name</span> <span class="o">=</span> <span class="s1">'student'</span><span class="p">,</span>
             <span class="n">value_name</span><span class="o">=</span><span class="s1">'scores'</span>
            <span class="p">)</span>
       <span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">'field'</span><span class="p">,</span><span class="s1">'scores'</span><span class="p">],</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
      <span class="p">)</span>

<span class="n">res</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>field</th>
      <th>subject</th>
      <th>student</th>
      <th>scores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Matilda</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Matilda</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Humanities</td>
      <td>Classics</td>
      <td>Nicholas</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Humanities</td>
      <td>History</td>
      <td>Nicholas</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Matilda</td>
      <td>5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Matilda</td>
      <td>7</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Performance</td>
      <td>Music</td>
      <td>Nicholas</td>
      <td>9</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Performance</td>
      <td>Drama</td>
      <td>Nicholas</td>
      <td>12</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="samukweku/data-wrangling-blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/data-wrangling-blog/spreadsheet/python/pandas/2020/05/10/Pivot-Tables-Simple-Unpivoting.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/data-wrangling-blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/data-wrangling-blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/data-wrangling-blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Data Wrangling Blog.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/samukweku" title="samukweku"><svg class="svg-icon grey"><use xlink:href="/data-wrangling-blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/samukweku" title="samukweku"><svg class="svg-icon grey"><use xlink:href="/data-wrangling-blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
